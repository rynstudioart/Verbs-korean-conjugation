<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Korean Grammar Table</title>
<script src="https://cdn.tailwindcss.com/3.4.17"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
body { font-family: 'Noto Sans KR', sans-serif; }
</style>
</head>

<body class="h-full bg-gradient-to-br from-pink-50 via-rose-50 to-amber-50 flex items-center justify-center p-6 overflow-auto">
<main class="w-full max-w-2xl">
<div class="bg-white rounded-2xl shadow-2xl border-2 border-rose-200 p-8">

<table class="w-full border-collapse">
<tbody>

<tr>
<td class="border-2 border-rose-300 p-6 text-center bg-yellow-100 w-1/2">
<input id="verbInput" type="text" placeholder="크다"
class="w-full px-4 py-3 text-2xl font-bold text-center border-2 border-yellow-300 rounded-lg">
</td>

<td class="border-2 border-rose-300 p-6 text-center bg-purple-100 w-1/2">
<select id="endingSelect"
class="w-full px-4 py-3 text-2xl font-bold text-center border-2 border-purple-300 rounded-lg">
<option value="present">요 (Present)</option>
<option value="past">았어요 / 었어요 (Past)</option>
<option value="future">ㄹ 거예요 / 을 거예요 (Future)</option>
</select>
</td>
</tr>

<tr>
<td class="border-2 border-rose-300 p-6 text-center bg-amber-100">
<select id="ruleSelect"
class="w-full px-4 py-3 text-xl font-bold text-center border-2 border-amber-300 rounded-lg">
</select>
</td>

<td class="border-2 border-rose-300 p-6 bg-emerald-100">
<div id="ruleDisplay"
class="text-lg font-bold text-emerald-700 leading-relaxed">
-
</div>
</td>
</tr>
</tbody>
</table>

<div class="mt-6 border-2 border-purple-300 p-6 text-center bg-purple-100 rounded-xl">
<div id="finalResult" class="text-4xl font-bold text-purple-700">-</div>
</div>

</div>
</main>

<script>
const verbInput = document.getElementById("verbInput");
const ruleSelect = document.getElementById("ruleSelect");
const endingSelect = document.getElementById("endingSelect");
const finalResult = document.getElementById("finalResult");
const ruleDisplay = document.getElementById("ruleDisplay");

verbInput.addEventListener("input", update);
ruleSelect.addEventListener("change", update);
endingSelect.addEventListener("change", updateRulesByEnding);

function updateRulesByEnding() {
const tense = endingSelect.value;

if (tense === "present") {
ruleSelect.innerHTML = `
<option value="">Select rule</option>
<option value="1">General</option>
<option value="2">ㅗ / ㅜ combine</option>
<option value="3">ㅣ → ㅕ</option>
<option value="4">ㅡ drop</option>
<option value="5">하다</option>
<option value="6">ㅂ irregular</option>
<option value="7">ㄷ irregular</option>
<option value="8">르 irregular</option>
<option value="9">ㅅ irregular</option>
<option value="10">ㅎ irregular</option>`;
}

if (tense === "past") {
ruleSelect.innerHTML = `
<option value="">Select rule</option>
<option value="p1">Base — 았어요 (ㅏ/ㅗ)</option>
<option value="p2">Base — 었어요</option>
<option value="p3">하다 → 했어요</option>
<option value="p4">ㅂ irregular</option>
<option value="p5">ㄷ irregular</option>
<option value="p6">르 irregular</option>
<option value="p7">ㅅ irregular</option>
<option value="p8">ㅎ irregular</option>`;
}

if (tense === "future") {
ruleSelect.innerHTML = `
<option value="">Select rule</option>
<option value="f1">No batchim → ㄹ 거예요</option>
<option value="f2">Batchim → 을 거예요</option>
<option value="f3">ㄹ final (no double ㄹ)</option>
<option value="f4">ㅂ irregular</option>
<option value="f5">ㄷ irregular</option>
<option value="f6">르 irregular</option>
<option value="f7">ㅅ irregular</option>`;
}

update();
}

function update() {

const verb = verbInput.value.trim();
const selectedRule = ruleSelect.value;
const tense = endingSelect.value;

if (!verb.endsWith("다") || selectedRule === "") {
finalResult.textContent = "-";
ruleDisplay.textContent = "-";
return;
}

let stem = verb.slice(0,-1);
let steps = "1️⃣ 다 removed → " + stem + "<br>";
steps += "2️⃣ Rule: " + ruleSelect.options[ruleSelect.selectedIndex].text + "<br>";

const lastChar = stem[stem.length - 1];
const base = lastChar.charCodeAt(0) - 0xAC00;

if (base < 0 || base > 11171) {
finalResult.textContent = "-";
ruleDisplay.innerHTML = "Invalid Korean verb";
return;
}

const initial = Math.floor(base/588);
const medial = Math.floor((base%588)/28);
const final = base%28;

/* PAST */
if (tense==="past"){
let pastEnding=(medial===0||medial===8)?"았어요":"었어요";
finalResult.textContent=stem+pastEnding;
ruleDisplay.innerHTML=steps+"3️⃣ Added "+pastEnding;
return;
}

/* FUTURE */
if (tense==="future"){
if(final===0){
finalResult.textContent=stem+"ㄹ 거예요";
ruleDisplay.innerHTML=steps+"3️⃣ No batchim → ㄹ 거예요";
}else{
finalResult.textContent=stem+"을 거예요";
ruleDisplay.innerHTML=steps+"3️⃣ Batchim → 을 거예요";
}
return;
}

/* PRESENT */
if (tense==="present"){
let presEnding=(medial===0||medial===8)?"아요":"어요";
finalResult.textContent=stem+presEnding;
ruleDisplay.innerHTML=steps+"3️⃣ Added "+presEnding;
return;
}

}

updateRulesByEnding();
</script>

</body>
</html>
